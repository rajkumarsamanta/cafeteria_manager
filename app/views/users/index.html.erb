<section class="MenuSection">
  <% if @current_user %>
  <div>
    <hr>
    <% if Cart.of_user(@current_user.id) && @current_user.role != "owner" %>
      <table>
        <tr> <td>
    <% end %>

      <% if !MenuCategory.all.empty? %>
      <p class = "Menu-title">Active Manu </p>
      <div class="MenuCategory-div">
      <ul class="MenuUl-list">
        <% MenuCategory.all.each do |menu| %>
          <% if menu.active %>
            <div class="UserList-div">
            <li class="MenuItems-list">
              <label class="MenuItems-container">
                <%= form_with(url: "/menu_categories/#{menu.id}", method: "GET") do %>
                  <%= check_box_tag("menu_selected", nil,
                    if session[:menu_update]
                      false
                    else
                      menu.selected?(session[:selected_menu_category_id].to_i)
                    end,
                      :class=>"DueItem-checkbox", :onclick=>"this.form.submit()"
                                  )
                  %>
                <% end %>
                <p class= <%= menu.active ? "BoldUser-text" : "InactiveMenu-text" %> >
                  <%= menu.name %>
                </p>
              </label>
            </li>
            </div>
            <% if menu.active %>
              <% if (menu.selected?(session[:selected_menu_category_id].to_i) && (MenuItem.exist?(session[:selected_menu_category_id].to_i))) %>
                <p class = "Order-items">Items. </p>
                <div class="OrderItemHeading-div">
                  <p class="OrderItemHeading-name">Name </p>
                  <p class="ItemHeading-description">Description </p>
                  <p class="ItemHeading-rate">Rate (Rs) </p>
                </div>
                <div class="MenuItems-div">
                  <ul class="MenuUl-list">
                    <% MenuItem.of_category(session[:selected_menu_category_id].to_i).each do |item| %>
                      <% if item.active %>
                        <div class="UserList-div">
                          <li class="MenuItems-list">
                            <label class="MenuItems-container">
                              <% if @current_user.role == "owner"%>
                                <%= form_with(url: "/menu_items/#{item.id}", method: "GET") do %>
                                  <%= check_box_tag("menu_item_selected", nil,
                                              item.selected?(session[:selected_menu_item_id].to_i),
                                              :class=>"DueItem-checkbox",
                                              :onclick=>"this.form.submit()"
                                                          )
                                  %>
                                <% end %>
                              <% end %>
                              <p class= <%= item.active ? "ActiveMenuItem-name" : "InactiveOrderCart-item_text" %> >
                                <%= item.name %>
                              </p>
                              <p class= <%= item.active ? "ActiveMenuItem-description" : "InactiveOrderCart-item_text" %> >
                                <%= item.description %>
                              </p>
                              <p class= <%= item.active ? "ActiveMenuItem-price" : "InactiveOrderCart-item_text" %> >
                                <%= item.price %>
                              </p>
                              <% if @current_user.role != "owner"%>
                                <% if item.active %>
                                  <p class="UserItem-update" >
                                    <a href="javascript:void(0)" >
                                      <%= form_with(url: "/carts/#{item.id}/edit", method: "GET") do %>
                                        <%= button_tag("Add to Cart", :class=>"UserItem-update" ) %>
                                      <% end%>
                                    </a>
                                  </p>
                                <% end %>
                              <% end %>
                            </label>
                          </li>
                        </div>
                        <hr>
                      <% end %>
                    <% end %>
                  </ul>
                </div>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </ul>
      </div>
      <% end %>
    <% if Cart.of_user(@current_user.id) && @current_user.role != "owner" %>
      </td>
      <td>
      <p class = "Order-items">Items in Cart </p>
      <div class="OrderCart-div">
        <div class="OrderItemHeading-div">
          <p class="CartItemHeading-name">Name </p>
          <p class="ItemHeading-rate">Rate </p>
          <p class="ItemHeading-quantity">Quantity </p>
          <p class="ItemHeading-amount">Amount </p>
        </div>
        <hr>
        <% total = 0 %>
        <% CartItem.of_cart_id(Cart.of_user(@current_user.id).id).each do |item| %>
          <div class="CartItem-div">
            <li class="MenuItems-list">
              <label class="MenuItems-container">
                <p class="ActiveOrderCart-item_name" >
                  <%= item.menu_item_name %>
                </p>
                <p class="ActiveOrderCart-item_price"  >
                  <%= item.menu_item_price %>
                </p>
                <div class="CartQuantity-div">
                  <p class="UserItem-update" >
                    <a href="javascript:void(0)" >
                      <%= form_with(url: "/cart_items/#{item.id}/minus", method: "GET") do %>
                        <%= button_tag("-", :class=>"CartItem-minus" ) %>
                      <% end%>
                    </a>
                  </p>
                  <p class="Cart-item_quantity" >
                    <%= item.quantity %>
                  </p>
                  <p class="UserItem-update" >
                    <a href="javascript:void(0)" >
                      <%= form_with(url: "/cart_items/#{item.id}/plus", method: "GET") do %>
                        <%= button_tag("+", :class=>"CartItem-plus" ) %>
                      <% end%>
                    </a>
                  </p>
                </div>
                <p class="ActiveOrderCart-item_text" >
                  <%= item.menu_item_price*item.quantity %>
                </p>
                <p class="UserItem-update" >
                  <a href="javascript:void(0)" >
                    <%= form_with(url: "/cart_items/#{item.id}", method: "delete") do %>
                      <%= button_tag("Delete item", :class=>"UserItem-update" ) %>
                    <% end%>
                  </a>
                </p>
              </label>
            </li>
          </div>
          <hr>
          <p class="ActiveOrderCart-item_text" >
            <% total = total + item.menu_item_price*item.quantity %>
          </p>
        <% end %>
        <div  class="OrderConfirm-div">
          <p class="CartItem-update" >
              <a href="javascript:void(0)" >
                <%= form_with(url: "/orders", method: "POST") do %>
                  <%= button_tag("Confirm Order", :class=>"CartItem-confirm" ) %>
                <% end%>
              </a>
          </p>
          <p class="OrderClerk-total" > Total:
            <%= total %>
          </p>
        </div>
      </div>
      </td>
      </tr>
      </table>
    <% end %>
    </div>
  <% end %>
</section>
